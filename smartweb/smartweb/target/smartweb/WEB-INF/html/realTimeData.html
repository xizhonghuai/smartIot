<!DOCTYPE html>
<html>
<head>
    <title>平台</title>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Blue Moon - Responsive Admin Dashboard" name="description"/>
    <meta content="Notifications, Admin, Dashboard, Bootstrap3, Sass, transform, CSS3, HTML5, Web design, UI Design, Responsive Dashboard, Responsive Admin, Admin Theme, Best Admin UI, Bootstrap Theme, Wrapbootstrap, Bootstrap, bootstrap.gallery"
          name="keywords"/>
    <meta content="Bootstrap Gallery" name="author"/>
    <link href="img/favicon.ico" rel="shortcut icon">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/new.css" rel="stylesheet">
    <link href="css/charts-graphs.css" rel="stylesheet">
    <!-- Datepicker CSS -->
    <link href="css/datepicker.css" rel="stylesheet" type="text/css">

    <link href="fonts/font-awesome.min.css" rel="stylesheet">

    <link href="http://cache.amap.com/lbs/static/main1119.css" rel="stylesheet"/>

    <link href="css/plugins/jqgrid/ui.jqgridffe4.css?0820" rel="stylesheet">

    <!-- HTML5 shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<!-- Header Start -->
<header>
    <a class="logo" href="index.html" style="width: 500px">
        <!--<img src="img/logo.png" alt="Logo"/>-->
        <span id="systemTitle" style="font-family:黑体;font-size:25px;font-weight:bold;color:#0089BF"></span>
    </a>
    <div class="pull-right">
        <ul class="clearfix" id="mini-nav">
            <li class="list-box hidden-xs">
                <a data-target="#modalMd" data-toggle="modal" href="#">
                    <span class="text-white">Code</span> <i class="fa fa-code"></i>
                </a>
                <!-- Modal -->
                <div aria-hidden="true" aria-labelledby="myModalLabel5" class="modal fade" id="modalMd" role="dialog"
                     tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;
                                </button>
                                <h4 class="modal-title text-danger" id="myModalLabel5">Coding Style </h4>
                            </div>
                            <div class="modal-body">
                                <img alt="Esquare Admin" src="img/documentation.png">
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-danger" data-dismiss="modal" type="button"><i
                                        class="fa fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="list-box dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="drop5" role="button">
                    <i class="fa fa-film"></i>
                </a>
                <span class="info-label info-bg">9+</span>
                <ul class="dropdown-menu stats-widget clearfix">
                    <li>
                        <h5 class="text-success">$37895</h5>
                        <p>Revenue <span class="text-success">+2%</span></p>
                        <div class="progress progress-mini">
                            <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="40"
                                 class="progress-bar progress-bar-success" role="progressbar" style="width: 40%">
                                <span class="sr-only">40% Complete (success)</span>
                            </div>
                        </div>
                    </li>
                    <li>
                        <h5 class="text-warning">47,892</h5>
                        <p>Downloads <span class="text-warning">+39%</span></p>
                        <div class="progress progress-mini">
                            <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="40"
                                 class="progress-bar progress-bar-warning" role="progressbar" style="width: 40%">
                                <span class="sr-only">40% Complete (warning)</span>
                            </div>
                        </div>
                    </li>
                    <li>
                        <h5 class="text-danger">28214</h5>
                        <p>Uploads <span class="text-danger">-7%</span></p>
                        <div class="progress progress-mini">
                            <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="40"
                                 class="progress-bar progress-bar-danger" role="progressbar" style="width: 40%">
                                <span class="sr-only">40% Complete (danger)</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </li>
            <li class="list-box dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="drop5" role="button">
                    <i class="fa fa-calendar"></i>
                </a>
                <span class="info-label success-bg">6</span>
                <ul class="dropdown-menu server-activity">
                    <li>
                        <p><i class="fa fa-flag text-info"></i> Pending request<span class="time">3 hrs</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-fire text-warning"></i> Server Crashed<span class="time">3mins</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-user text-success"></i> 3 New users<span class="time">1 min</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-bell text-danger"></i>9 pending requests<span class="time">5 min</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-plane text-info"></i> Performance<span class="time">25 min</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-envelope text-warning"></i>12 new emails<span class="time">25 min</span></p>
                    </li>
                    <li>
                        <p><i class="fa fa-cog icon-spin text-success"></i> Location settings<span
                                class="time">4 hrs</span></p>
                    </li>
                </ul>
            </li>

        </ul>
    </div>
</header>
<!-- Header End -->

<!-- Main Container start -->
<div class="dashboard-container">

    <div class="container">
        <!-- Top Nav Start -->
        <div id='cssmenu'>
            <ul>
                <li>
                    <a href='index.html'>
                        <i class="fa fa-dashboard"></i>
                        首页
                    </a>
                </li>
                <li>
                    <a href="devStatus.html">
                        <i class="fa fa-align-justify"></i>
                        运行状况
                    </a>
                </li>


                <li class='active'>
                    <a href="realTimeData.html">
                        <i class="fa fa-th-list"></i>
                        实时数据
                    </a>
                </li>


                <li>
                    <a href="camera.html">
                        <i class="fa  fa-video-camera"></i>
                        图像监控
                    </a>
                </li>


                <li>
                    <a href="historyData.html">
                        <i class="fa fa-clock-o"></i>
                        历史数据
                    </a>
                </li>


                <!--  <li>
                      <a href="#">
                          <i class="fa fa-bar-chart-o"></i>
                          统计分析
                      </a>
                  </li>-->

                <li>
                    <a href="debug.html">
                        <i class="fa fa-cloud"></i>
                        终端控制
                    </a>
                </li>


                <!--                <li>-->
                <!--                    <a href="Debug.html">-->
                <!--                        <i class="fa fa-bug"></i>-->
                <!--                        运维调试-->
                <!--                    </a>-->
                <!--                </li>-->


            </ul>
        </div>
        <!-- Top Nav End -->


        <!-- Dashboard Wrapper Start -->
        <div class="dashboard-wrapper-lg" style="min-height:520px">
            <div id="deviceStatus">


                <div class="row">

                    <div class="col-lg-2">
                        <div class="input-group">
                            <input class="form-control" id="cityId" placeholder="城市"
                                   type="text">
                            <div class="input-group-btn">
                                <button class="btn btn-white dropdown-toggle" data-toggle="dropdown"
                                        type="button">
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                </ul>
                            </div>
                        </div>
                    </div>


                    <div class="col-lg-2">
                        <div class="input-group">
                            <input class="form-control" id="areaId" placeholder="区县"
                                   type="text">
                            <div class="input-group-btn">
                                <button class="btn btn-white dropdown-toggle" data-toggle="dropdown"
                                        type="button">
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                </ul>
                            </div>
                        </div>
                    </div>


                    <div class="col-lg-2">

                        <input AUTOCOMPLETE="off" class="form-control" id="deviceId"
                               placeholder="设备ID" type="text">

                    </div>


                    <div class="col-lg-2">
                        <div class="input-group">
                            <input class="form-control" id="online" placeholder="选择通信状态"
                                   type="text">
                            <div class="input-group-btn">
                                <button class="btn btn-white dropdown-toggle" data-toggle="dropdown"
                                        type="button">
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                                </ul>
                            </div>

                        </div>
                    </div>


                    <div class="col-lg-2">
                        <div class="input-group">
                            <button class="btn btn-primary " onclick="findData()"
                                    type="button">
                                <i class="fa fa-search"></i> <span class="bold">搜索</span>
                            </button>
                        </div>
                    </div>
                </div>
                <br>


                <div class="jqGrid_wrapper" id="jqw1">
                    <table id="devStatusTable"></table>
                    <div id="devStatusPager"></div>
                </div>
            </div>

            <div id="deviceData">

                <a data-original-title="" href="#" onclick="pageSwith('0')" style="float: right" title="">
                    返回状态页面
                </a>


                <div id="dataTitle">
                </div>

                <br>


                <div class="jqGrid_wrapper" id="jqw2">
                    <table id="devDataTable"></table>
                    <div id="devDataPager"></div>
                </div>

                <div class="row">
                    <h1></h1>
                </div>

                <div class="row">
                    <div id="lines" style="height: 500px"></div>
                </div>
            </div>


        </div>


        <footer>
            <p>© 重庆XX有限公司 2020</p>
        </footer>

    </div>
</div>
<!-- Main Container end -->

<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.scrollUp.js"></script>

<!-- jQuery UI JS -->
<script src="js/jquery-ui-v1.10.3.js"></script>

<!-- Just Gage -->
<!--<script src="js/justgage/justgage.js"></script>-->
<script src="js/justgage/raphael.2.1.0.min.js"></script>

<!-- Flot Charts -->
<script src="js/flot/jquery.flot.js"></script>
<script src="js/flot/jquery.flot.orderBar.min.js"></script>
<script src="js/flot/jquery.flot.stack.min.js"></script>
<script src="js/flot/jquery.flot.pie.min.js"></script>
<script src="js/flot/jquery.flot.tooltip.min.js"></script>
<script src="js/flot/jquery.flot.resize.min.js"></script>


<!-- Custom JS -->
<script src="js/menu.js"></script>

<script src="js/common.js"></script>
<script src="js/plugins/jqgrid/i18n/grid.locale-cnffe4.js?0820"></script>
<script src="js/plugins/jqgrid/jquery.jqGrid.minffe4.js?0820"></script>
<script src="js/plugins/suggest/bootstrap-suggest.min.js"></script>


<script src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"
        type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js" type="text/javascript"></script>
<script src="https://api.map.baidu.com/api?v=2.0&ak=gqopqYo3H9px6AW32eoGuoUz59EcrqEx" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js" type="text/javascript"></script>
<script src="http://echarts.baidu.com/gallery/vendors/simplex.js" type="text/javascript"></script>

<script type="text/javascript">


    var token = GetData("../getToken",null);
    var tokenData = JSON.parse(token.result);

    document.getElementById("systemTitle").innerHTML = "&nbsp;"+tokenData.systemTitle;




    var cityList = new Array();
    var areaList = new Array();

    var cityId_temp = null;
    var areaId_temp = null;
    var params1_temp = null;


    // var par = new Object()
    // par.areaId = null;
    // // par.deviceId = null;
    // // par.deviceName = null;
    // // par.params1 = null;


    function getCity() {
        var data = GetData("../getCity", null);
        if (data.statusCode == 200) {
            cityList = data.result;
            cityList.unshift({"id": -1, "cityName": "全部"});
        }
    }

    function getArea(area) {
        var data = GetData("../getArea", area);
        if (data.statusCode == 200) {
            areaList = data.result;
            areaList.unshift({"id": -1, "areaName": "全部"});
        }
    }

    function findData() {

        var deviceId = $("#deviceId").val().trim();
        // var deviceName = $("#deviceName").val().trim();
        var deviceName = null;


        var dev = new Object();

        var par = "";

        if (deviceId.length > 0) par = par + "deviceId=" + deviceId + "&";
        // if (deviceName.length > 0) par = par+"deviceName="+(deviceName)+"&";
        if ((areaId_temp != null) && (areaId_temp != -1)) par = par + "areaId=" + areaId_temp + "&";
        if ((cityId_temp != null) && (cityId_temp != -1)) par = par + "cityId=" + cityId_temp + "&";

        if (params1_temp != null) par = par + "params1=" + params1_temp + "&";


        $('#devStatusTable').jqGrid('clearGridData');

        $('#devStatusTable').jqGrid(
            'setGridParam',
            {
                datatype: 'json',
                //  mtype: 'get',
                url: "../getDeviceRealTimeData?params2=0&userId="+tokenData.id+"&" + par,

            }).trigger('reloadGrid');


    }


    $.jgrid.defaults.styleUI = "Bootstrap";

    function pageSwith(flag) {
        if (flag == "1") {
            $("#deviceStatus").hide();
            $("#deviceData").show();

        } else {
            $("#deviceStatus").show();
            $("#deviceData").hide();
        }
    }

    function showDevData(deviceId) {

        pageSwith("1");

        var par = {
            "deviceId": deviceId,
            "params2": 1

        }

        var data = GetData("../getDeviceRealTimeData", par);


        $('#devDataTable').jqGrid('clearGridData');

        $('#devDataTable').jqGrid(
            'setGridParam',
            {
                datatype: 'json',
                mtype: 'POST',
                postData: par,
                url: "../getDeviceRealTimeData"

            }).trigger('reloadGrid');


        var dataTitle = deviceId + "__" + data[0].deviceName + "   上报时间：" + DateFormat(data[0].cyDate);
        document.getElementById("dataTitle").innerHTML = dataTitle;


        //echarts
        var dom = document.getElementById("lines");
        var myChart = echarts.init(dom);
        var app = {};
        app.title = '曲线分析';

        // var colors = ['#5793f3', '#d14a61', '#675bba'];


        function randomArray() {
            var data = [];
            for (var i = 0; i < 11; i++) {
                data.push(Math.floor(Math.random() * (80 - 20)) + 20);
            }
            return data;
        }


        var sensorFields = [];
        var selectedObj = new Object();

        for (var i = 0; i < data.length; i++) {
            sensorFields.push(data[i].propertyName);
            if (i == 0){
                selectedObj[data[i].propertyName] = true;
            } else {
                selectedObj[data[i].propertyName] = false;
            }
        }

        var lineData = [];

        for (var i = 0; i < sensorFields.length; i++) {
            var dataObj = new Object();

            dataObj.name = sensorFields[i];
            dataObj.type = 'line';
            dataObj.smooth = true;
            dataObj.data = randomArray();

            lineData.push(dataObj);
        }


        var option = {

            title: {
                text: "传感器数据变化情况",
                left: 80
            },
            tooltip: {
                trigger: 'none',
                axisPointer: {
                    type: 'cross'
                }
            },
            legend: {
                type: "scroll",
                data: sensorFields,
                selected:selectedObj,
            },
            grid: {
                top: 70,
                bottom: 50
            },
            xAxis: [
                {
                    type: 'category',
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLine: {
                        onZero: false

                    },
                    axisPointer: {
                        label: {
                            formatter: function (params) {
                                return '采样值  ' + params.value
                                    + (params.seriesData.length ? '：' + params.seriesData[0].data : '');
                            }
                        }
                    },
                    data: ["2016-1", "2016-2", "2016-3", "2016-4", "2016-5", "2016-6", "2016-7", "2016-8", "2016-9", "2016-10", "2016-11", "2016-12"]
                }

            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            series: lineData
        };

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }


    }


    $("#devStatusTable").jqGrid(
        {
            url: "../getDeviceRealTimeData",
            datatype: "json",
            mtype: 'POST',
            postData: {"params2": 0},
            height: 450,
            autoScroll: false,//当autoScroll和shrinkToFit均为false时，会出现行滚动条
            //    shrinkToFit: false,//是否列宽度自适应。true=适应 false=不适应
            autowidth: true,
            rowNum: 10,
            rowList: [10, 20, 30],
            colNames: ["测站编码", "测站名称", "通信状态",
                "管理单位", "联系电话", "城市", "详细地址", "采样日期"],
            colModel: [
                {
                    name: "deviceId",
                    index: "deviceId",
                    width: 30,
                    sortable: false,
                    key: true,
                    formatter: function (cellValue,
                                         options, rowObject) {

                        return "  <a  href=\"#\"  onclick=\"showDevData('" + cellValue + "')\">" + cellValue + "</a>";
                    }
                },
                {
                    name: "deviceName",
                    index: "deviceName",
                    editable: true,
                    width: 40,
                    sortable: false
                },
                {
                    name: "cyDate",
                    index: "cyDate",
                    width: 20,
                    sortable: false,
                    formatter: function (cellValue,
                                         options, rowObject) {

                        var onlineflag = checkTM(cellValue);
                        var online;
                        if (onlineflag) {
                            online = "<img src=\"images/zx.gif\"   title=\"通信正常\"/>" + "  在线";
                        } else {
                            online = "<img src=\"images/lx.gif\"   title=\"通信异常\" />" + "  离线";
                        }

                        return online;
                    }
                },

                {
                    name: "company",
                    index: "company",
                    width: 40,
                    sortable: false

                },
                {
                    name: "mangerTel",
                    index: "mangerTel",
                    width: 20,
                    sortable: false,

                },
                {
                    name: "cityName",
                    index: "cityName",
                    width: 15,
                    sortable: false

                },
                {
                    name: "address",
                    index: "address",
                    width: 40,
                    sortable: false

                },
                {
                    name: "cyDate",
                    index: "cyDate",
                    width: 30,
                    sortable: false,
                    formatter: function (cellValue,
                                         options, rowObject) {
                        return DateFormat(cellValue);
                    }

                }
            ],
            pager: "#devStatusPager",
            viewrecords: true,
            /* 	caption : "jqGrid 示例2", */
            add: true,
            edit: true,
            addtext: "Add",
            edittext: "Edit",
            hidegrid: false,

        });

    $("#devStatusTable").jqGrid('setGroupHeaders', {
        useColSpanStyle: true,
        groupHeaders: [
            {startColumnName: 'company', numberOfColumns: 4, titleText: '监测站基本信息'},


        ]
    });

    $("#devStatusTable").jqGrid('setFrozenColumns');//设置冻结列生效


    $("#devDataTable").jqGrid(
        {
            url: null,
            datatype: "json",
            mtype: 'POST',
            height: 500,
            autowidth: true,
            rowNum: 10,
            rowList: [10, 20, 30],
            colNames: ["数据类型", "采集值", "单位", "黄色预警值", "红色预警值", "预警等级", "传感器状态"],
            colModel: [
                {
                    name: "propertyName",
                    index: "propertyName",
                    width: 40,
                    sortable: false,
                    key: true
                },
                {
                    name: "valueAsNumber",
                    index: "valueAsNumber",
                    editable: true,
                    width: 40,
                    sortable: false
                },
                {
                    name: "unit",
                    index: "unit",
                    width: 30,
                    sortable: false
                },
                {
                    name: "warnY",
                    index: "warnY",
                    width: 30,
                    sortable: false
                },
                {
                    name: "warnR",
                    index: "warnR",
                    width: 30,
                    sortable: false,

                },
                {
                    name: "wang",
                    index: "wang",
                    width: 20,
                    sortable: false,

                },
                {
                    name: "sensorStatus",
                    index: "sensorStatus",
                    width: 20,
                    sortable: false,
                    formatter: function (cellValue,
                                         options, rowObject) {
                        if (cellValue == true) {
                            return "正常";
                        }
                        return "异常";
                    }

                }
            ],
            pager: "#devDataPager",
            viewrecords: true,
            /* 	caption : "jqGrid 示例2", */
            add: true,
            edit: true,
            addtext: "Add",
            edittext: "Edit",
            hidegrid: false,

        });


    $(window).bind("resize", function () {
        var width1 = $("#jqw1").width();
        var width2 = $("#jqw2").width();
        $("#devStatusTable").setGridWidth(width1);
        $("#devDataTable").setGridWidth(width2);

    });


    pageSwith("0");


    getCity();
    $("#cityId").bsSuggest({

        idField: "id",    //id字段
        keyField: "cityName",   //key字段
        effectiveFields: ["cityName"],//显示的有效字段
        data: {
            'value': cityList
        },

    }).on('onSetSelectValue', function (e, keyword) {

        cityId_temp = keyword.id;
        var area = {
            "cityId": keyword.id
        }
        getArea(area);

        $("#areaId").bsSuggest("destroy");
        $("#areaId").val("");
        areaId_temp = null;
        $("#areaId").bsSuggest({

            idField: "id",    //id字段
            keyField: "areaName",   //key字段
            effectiveFields: ["areaName"],//显示的有效字段
            data: {
                'value': areaList
            },

        }).on('onSetSelectValue', function (e, keyword) {
            console.log('onSetSelectValue: ', keyword);
            areaId_temp = keyword.id;
        });
    });

    $("#online").bsSuggest({
        effectiveFields: ["onlineStatus"],
        keyField: "onlineStatus",
        data: {
            'value': [{
                'id': '0',
                'onlineStatus': '全部'
            }, {
                'id': '1',
                'onlineStatus': '在线'
            }, {
                'id': '2',
                'onlineStatus': '离线'
            }

            ]
        }
    }).on(
        'onSetSelectValue',
        function (e, keyword) {
            console.log('onSetSelectValue: ', keyword);

            params1_temp = keyword.id;

            //     $('#deviceStatusList').jqGrid('clearGridData');
            //     $('#deviceStatusList').jqGrid(
            //         // 'setGridParam',
            //         // {
            //         //     datatype: 'json',
            //         //     url: "../getDeviceStatus?cityId=-1&untisId="
            //         //         + par.untisId + "&online=" + par.online
            //         // }).trigger('reloadGrid');
            //
        });


</script>

</body>
</html>